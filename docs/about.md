## Терминология

* `sources` (ресурсы) - репозитории, данные из которым попадут в сборку.
* `targets` (цели) - цели для сборки. Целью для сборки является выбранный тег или ветка репозитория.
* `tasks` (задачи) - набор модулей выполняющих определенные задачи из которых состоит сборка для одной цели,
  например такие как клонирование репозитория или установка зависимостей.

## Принцип работы

Работа инструмента может быть четко разделена на несколько последовательных шагов.

### Шаг #1 src/tasks/init.js

Это погдотовительный шаг для сборки. На этом этапе создаются директории `contentDirectory` и `outputDirectory` если их несуществует.
При этом внутри `outputDirectory` происходит проверка наличия гит-репозитория (по наличию папки `.git`) и, если гит-репозиторий
отсутствует, то он инициализируется и привязывается к удаленному репозиторию в котором будут храниться финальные результаты сборки для сайта.

### Шаг #2 src/tasks/get_config.js

На этом шаге файл `repositories.json` открывается и парсится. Его древовидная структура превращается в плоский список элементами которого являются
объекты, описывающие информацию по отдельным репозиториям (sources), с добавлением полей владельца и логическим флагом для обозначения
типа приватности этого репозитория (корпоративный или общий github). Такая структура данных содержит всю необходимую
информацию для работы с github API в удобном виде.

### Шаг #3 src/tasks/get_repositories.js

На этом шаге для каждого ресурса построенного на этапе #2 по названию репозитория
и владельцу происходит построение ssh ссылки на git-репозиторий для которого должна выполниться сборка.

### Шаг #4 src/tasks/get_tags.js

На этом шаге для каждого ресурса построенного на этапе #2 по названию репозитория
и владельцу происходит запрос на получение детальной информации о существующих тегах (tags) репозитория. Полученный список
фильтруется по критерию совпадения с массивами тегов (tags) указанных в полях `include` и `exclude` соответствующего ресурса.

### Шаг #5 src/tasks/get_branches.js

На этом шаге для каждого ресурса построенного на этапе #2 по названию репозитория
и владельцу происходит запрос на получение детальной информации о существующих ветках (branches) репозитория. Полученный список
фильтруется по критерию совпадения с массивами веток (branches) указанных в полях `include` и `exclude` соответствующего ресурса.

### Шаг #6 src/tasks/create_targets.js

Для каждого тега и каждой ветки, оставшихся после фильтрации на этапах #4 и #5 создаются цели для сборки.
Цель представляет собой объект хранящий в себе всю необходимую информацию для сборки, такую как название ветки или тега,
путь в который репозиторию будет склонирован и.т.д. Кроме этого цель включает в себя массив задач которые должны последовательно
выполнены для ее сборки.

### Шаг #7 src/tasks/execute_targets.js

На этом шаге происходит последовательное выполнение задач для каждой из целей сборки.
При этом выполнение сборки для каждой из целей выполняется асинхронно и независимо от других целей.

### Шаг #8 src/tasks/update_config.js

На этом шаге происходит перезапись файла `repositories.json`. Теги или ветки ресурсы которых были успешно собраны добавляются в `exclude` массивы
соответствующих репозиториев и файл перезаписывается. Это дает возможность исключить повторную сборку уже собраных ресурсов.

### Шаг #9 collect_results

Результаты сборки в директории `/output` добавляются в систему контроля версий, происходит коммит и пуш собранных данных в репозиторий `dataConfig`.