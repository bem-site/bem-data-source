bem-data-source
===============

Инструмент для версионированной сборки документации и примеров библиотек для проектов bem-info legoa-www.

### Установка

* клонировать репозиотрий `git clone git://github.com/bem/bem-data-source.git`
* перейти в директорию с выкачанным проектом `cd bem-data-source`
* запустить команду `make`

Команда `make` устанавливает зависимости для проекта и генерирует конфигурационный файл:
* `config/credentials.json`

### Конфигурирование

Конфигурация инструмента описывается в файлах `config/config.json`, `config/credentials.json`.

#### Файл config/config.json

* `logLevel` - флаг уровня логгирования.

#### Файл config/credentials.json

Файл с токенами доступа к публичным и приватным репозиториям (github.com и github.yandex-team.ru соответственно)
Необходимо сгенерировать токены доступа в настройках профиля пользователя на github.com и github.yandex.team.ru
и вставить как значения соответствующих token-полей в данном файле.

```
"credentials": {
    "public": {
        "type": "oauth",
        "token": ""
    },
    "private": {
        "type": "oauth",
        "token": ""
    }
}
```

Также в этом файле настраивается конфигурация для доступа целевому репозиторию
в который будет помещен результат сборки, например:

```
"dataConfig": {
    "private": "false",
    "user": "bem",
    "repo": "bem-info-libs",
    "ref": "master"
}
```

#### Файл config/pattern.js

В этом файле описываются для каждой библиотеки можно переопределить дефолтные настройки сборки, например:

```
'bem-components': {
    builder: 'enb',
    command: 'YENV=production enb make tests && enb make docs',
    copy: ['*.docs', '*.tests'],
    docs: {
        readme: {
            folder: '',
            pattern: 'README.md'
        },
        changelog: {
            folder: '',
            pattern: 'CHANGELOG.md'
        },
        migration: {
            folder: '',
            pattern: 'MIGRATION.md'
        },
        notes: {
            folder: '',
            pattern: 'MIGRATION.md'
        }
        pattern: {
            data: '%s.data.json',
            jsdoc: '%s.jsdoc.html'
        },
    },    
    skip: []
}
```

Здесь:

##### builder 
Название инструмента с помощью которого будет выполняться сборка документации и примеров.

Допустимые значения `enb` и `bem-tools`. 
Значение по умолчанию `bem-tools`.
 
##### command 
Cтрока с названием команды для запуска сборки. 
Значение по умолчанию `npm run build`

##### copy 
Массив с шаблонами названий директорий с файлами документации и примеров, 
которые должны попасть в финальный результат сборки. 
Первым элементом данного массива должен быть шаблон директорий
которые содержат файлы с документацией по блокам.

Значение по умолчанию `['*.sets']`

##### docs

Объект с полями, которые в свою очередь также являются объектами.
Позволяет задавать произвольный набор документов которые должны попасть в сборку библиотеки

```
docs: {
    readme: {
        folder: '',
        pattern: 'README.md'
    },
    changelog: {
        folder: 'docs',
        pattern: {
            en: 'CHANGELOG.en.md',
            ru: 'CHANGELOG.en.md'
        }
    },
    migration: {
        pattern: 'https://github.com/bem/bem-core/tree/v2/MIGRATION.md'
    }
    ...
}    
```
Здесь 'README.md' - загружается из корня проекта. Файлы changelog-ов будут загружены из директории 'docs',
по маске 'CHANGELOG.en.md' и 'CHANGELOG.ru.md' соответственно. При этом будут выбраны последние версии таких файлов,
в случае когда в данной директории хранится несколько changelog - файлов и их названия содержат номер версии библиотеки.
Файл миграции напрямую загружается с гитхаба с помощью github API с указанного адреса.

Из данного примера видно, что можно задавать разные файлы для различных языков, а также указывать
произвольный url к файлу как адрес данного файла в браузере.

##### pattern 
Объект с полями `data` и `jsdoc` в котором можно указать шаблоны файлов с документацией и js документацией к блокам. 

Значение по умолчанию:

```
pattern: {
    data: '%s.data.json',
    jsdoc: '%s.jsdoc.json'
}
```

##### skip 
Массив с именами шагов сборки которые не должны быть выполнены для текущей библиотеки. 

Допустимые элементы массива: 
* 'npmInstall' 
* 'npmInstallBemSets' 
* 'npmInstallBem' 
* 'npmRunDeps'
* 'copyBorschik' 
* 'npmRunBuild'
* 'copySets'
* 'collectSets'.


### Запуск

Запуск выполняется командой `node bin/start.js` с указанием дополнительных опций:

* `-p` или `--private`, если репозиторий внутренний
* `-u` или `--user` - имя пользователя или название организации (обязательный параметр)
* `-r` или `--repo` - название репозитория (обязательный параметр)
* `-t` или `--tags` - название версии (тега) библиотеки
* `-b` или `--branches` - название ветки библиотеки

Ответственный за разработку @bemer

Вопросы и пожелания присылать по адресу: bemer@yandex-team.ru
