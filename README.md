bem-data-source
===============

Инструмент для версионированной сборки документации и примеров библиотек для проектов bem-info legoa-www.

### Установка

* клонировать репозиотрий `git clone git://github.com/bem/bem-data-source.git`
* перейти в директорию с выкачанным проектом `cd bem-data-source`
* запустить команду `make`

Команда `make` устанавливает зависимости для проекта и генерирует конфигурационные файлы:
* `config/credentials.json`
* `config/repositories.json`

### Конфигурирование

Конфигурация инструмента описывается в файлах `config/config.json`, `config/repositories.json`, `config/credentials.json`.

#### `config/config.json`

* `logLevel` - флаг уровня логгирования.
* `dataConfig` - конфигурация удаленного репозитория для выкладки собранных данных.
* `gitAPI` - конфигурация github API для доступа к приватным и публичным репозиториям github.

#### `config/repositories.json`

В файле `config/repositories.json` описываются репозитории участвующие в сборке.

ВНИМАНИЕ: При запуске команд  `make clean` или `make restart`
содержимое  файла `config/repositories.json` будет замещено содержимым файла `config/_repositories.json.

Структуру файла `repositories.json` можно разделить на 2 группы `private` и `public`. В разделе `private` описываются репозитории, находящиеся
на внутреннем корпоративном github-е `https://github.yandex-team.ru`. В разделе  `public` описываются репозитории, находящиеся
на внешнем публичном github-е `https://github.com`.

Внутри групп `private` и `public` репозитории также группируются по критерию владельца, которыми могут быть как организации `org`,
так и отдельные люди `user`.

Библиотека для сборки оисывается в конфигурационном файле объектом вида:

```
{
    {
        "name": "meccano",
        "targetDir": "meccano",
        "tags": {
            "include": [],
            "exclude": []
        },
        "branches": {
            "include": [],
            "exclude": []
        }
    }
}
```

Здесь:

* `name` - название репозитория (должно совпадать с названием репозитория на github)
* `targetDir` - название директории куда будет склонирован проект (относительно общей папки `contentDirectory`)
* `branches` - объект с полями `include` и `exclude`, значеними которых являются массивы с именами веток `branch` которые
будут соответственно включены и исключены из сборки проекта. После успешной сборки конфигурационный файл переписывается и
в массив `exclude` добавляется имя собранной ветки.
* `tags` - объект с полями `include` и `exclude`, значеними которых являются массивы с именами тегов `tag` которые
будут соответственно включены и исключены из сборки проекта. После успешной сборки конфигурационный файл переписывается и
в массив `exclude` добавляется имя собранного тега. Значением поля `include` для тегов могут быть также строки
`all` и `last`. `all` указывает на необходимость сборки всех существующих тегов, а `last` только последнего тега.
(здесь предполагается что теги имеют структуру 0.0.0, что дает возможность их явной сортировки)

#### `config/credentials.json`

Файл с токенами доступа к публичным и приватным репозиториям (github.com и github.yandex-team.ru соответственно)
Необходимо сгенерировать токены доступа в настройках профиля пользователя на github.com и github.yandex.team.ru
и вставить как значения соответствующих token-полей в данном файле.

```
{
    "credentials": {
        "public": {
            "type": "oauth",
            "token": ""
        },
        "private": {
            "type": "oauth",
            "token": ""
        }
    }
}
```

### Запуск

Запуск можно осуществлять в 2-х режимах:

 * Сборка по конфигурационному файлу `config/repositories.json`.
 * Точечная сборка библиотеки.

#### Сборка по конфигурационному файлу `config/repositories.json`.

В этом режиме цели для сборки будут браться из файла `config/repositories.json`.
Запуск сборщика можно осуществлять командами `npm start` или `node src/make.js`

#### Точечная сборка библиотеки

В этом режиме кроме сборки по конфигурационному файлу произойдет также принудительная сборка версии или тега библиотеки, указанной в параметрах команды запуска.
Запуск сборщика в таком режиме необходимо выполнять командой `node src/make.js` с указанием дополнительных параметров:

* `-p` или `--private` - true, если репозиторий внутренний, в остальных случаях false
* `-u` или `--user` - имя пользователя или название организации которой принадлежит репозиторий
* `-r` или `--repository` - название репозитория
* `-t` или `--tag` - название версии (тега) библиотеки
* `-b` или `--branch` - название ветки библиотеки

При этом раздел с указанным репозиторием должен находится в файле `config/repositories.json`. Указанные в параметрах тег или ветка
будут принудительно собраны. Результаты предыдущей сборки по этому тегу или этой ветке для данного репозитория будут потеряны.

Ответственный за разработку @bemer

Вопросы и пожелания присылать по адресу: bemer@yandex-team.ru
